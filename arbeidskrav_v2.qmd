---
title: "transport"
format: html
editor: visual
---

```{r}
library(tidyverse)
library(readr)
library(readxl)
library(dplyr)
library(stringr)
```

```{r}
# Les Excel-filene (juster filstiene etter hvor de ligger i prosjektet ditt)
tidligere_data <- read_excel("tidligere_data.xlsx")
ny_data <- read_excel("ny_data.xlsx")
```

```{r}
# Fjerne mellomrom og linjeskift fra kolonnenavnene i 'tidligere_data'
colnames(tidligere_data) <- str_trim(gsub("\r\n", "", colnames(tidligere_data)))

# Omdøpe variabler i 'tidligere_data' for å matche variablene i 'ny_data'
tidligere_data <- tidligere_data %>%
  rename(
    `Kjønn` = `Hvilket kjønn identifiserer du som?`,  # Omdøp "Hvilket kjønn identifiserer du som?" til "Kjønn"
    `Alder` = `Din alder`,  # Omdøp "Din alder" til "Alder"
    `Utdanning` = `Hva er din høyeste utdanning?`,  # Omdøp utdanning
    `Næring` = `I hvilken næring jobber du?`,  # Omdøp næring
    `Inntektsgruppe` = `Hvilken inntektsgruppe hører du til?`,  # Omdøp inntektsgruppe
    `Antall personer i husstanden` = `Hvor mange personer bor i din husstand?`,  # Omdøp antall personer
    `Antall med førerkort` = `Hvor mange i husstanden har førerkort?`,  # Omdøp førerkort
    `Transportmåte disponibelt` = `Hva har du til disposisjon?`,  # Omdøp transportmåte
    `Hvordan kommer du deg til jobb` = `Hva har du reist med siste uken?`,  # Omdøp hvordan du kommer deg til jobb
    `Tid brukt til jobb` = `Hvor lang er din pendletid til jobb?`,  # Omdøp tid brukt til jobb
    `Postnummer` = `Hva er ditt postnummer (bosted)`,  # Omdøp postnummer
    `Postnummer arbeidssted` = `Hva er ditt postnummer (arbeidsplass)`,  # Omdøp postnummer arbeidssted
    `Fast oppmøte` = `Har du fast oppmøtested?`,  # Omdøp fast oppmøte
    `Parkering ved jobb` = `Er det gode parkeringsmuligheter nær din arbeidsplass?`  # Omdøp parkering
  )

# Omdøpe variabler i 'ny_data' (hvis nødvendig) for å matche samme tema
ny_data <- ny_data %>%
  rename(
    `Kjønn` = `Hvilket kjønn identifiserer du deg som?`,  # Omdøp "Hvilket kjønn identifiserer du deg som?" til "Kjønn"
    `Alder` = `Hva er alderen din?`,  # Omdøp "Hva er alderen din?" til "Alder"
    `Utdanning` = `Hva er din høyeste utdanning?`,  # Omdøp utdanning
    `Næring` = `I hvilken næring jobber du?`,  # Omdøp næring
    `Inntektsgruppe` = `Hvilken inntektsgruppe tilhører du?`,  # Omdøp inntektsgruppe
    `Antall personer i husstanden` = `Hvor mange bor i din husstand?`,  # Omdøp antall personer
    `Antall med førerkort` = `Hvor mange har førerkort i din husstand?`,  # Omdøp førerkort
    `Transportmåte disponibelt` = `Hvilke muligheter har du tilgjengelig for reise til jobb?`,  # Omdøp transportmåte
    `Hvordan kommer du deg til jobb` = `Hvilke muligheter bruker du for å reise til jobb?`,  # Omdøp hvordan du kommer deg til jobb
    `Tid brukt til jobb` = `Hvor lang tid bruker du til jobb`,  # Omdøp tid brukt til jobb
    `Postnummer` = `Hvilket postnummer er din husstand plassert under?`,  # Omdøp postnummer
    `Postnummer arbeidssted` = `Hvilket postnummer er arbeidsplassen din plasser under?`,  # Omdøp postnummer arbeidssted
    `Fast oppmøte` = `Har du fast oppmøte til jobb?`,  # Omdøp fast oppmøte
    `Parkering ved jobb` = `Har du parkeringsmuligheter på jobb?`  # Omdøp parkering
  )
```

```{r}
# Velge felles variabler (tema) i begge datasettene
common_columns <- c("Starttidspunkt", "Kjønn", "Alder", "Utdanning", "Næring", "Inntektsgruppe",
                    "Antall personer i husstanden", "Antall med førerkort", "Transportmåte disponibelt",
                    "Hvordan kommer du deg til jobb", "Tid brukt til jobb", "Postnummer",
                    "Postnummer arbeidssted", "Fast oppmøte", "Parkering ved jobb")

# Slå sammen datasettene
merged_data <- bind_rows(
  select(ny_data, all_of(common_columns)),
  select(tidligere_data, all_of(common_columns))
)

# Se resultatet
head(merged_data)

# Sjekk at du har fått 160 observasjoner
nrow(merged_data)
```

```{r}
library(readr)
datasett_2014_2024 <- read_delim("datasett_2014_2024.csv", 
    delim = ";", escape_double = FALSE, trim_ws = TRUE)

Karmsundsgata <- read_delim("Karmsundsgata.csv", 
    delim = ";", escape_double = FALSE, trim_ws = TRUE)
```

```{r}
datasett_2014_2024 <- datasett_2014_2024 |> 
  filter(
    Felt == str_match_all(Felt, "Totalt"
    )
  )
```

```{r}
datasett_2014_2024 |> 
  ggplot(
    aes(
      x = ar,
      y = Trafikkmengde,
      colour = Navn
    )
  ) + 
  geom_line() 
```

```{r}
Karmsundsgata <- Karmsundsgata |> 
  mutate(
    Fra = `Fra tidspunkt`
  ) |> 
  select(-`Fra tidspunkt`)
```

```{r}
Karmsundsgata |> 
     filter(
    Felt == str_match_all(Felt, "Totalt"),
    
  ) |> 
  ggplot(
    aes(
      x = Fra,
      y = Trafikkmengde
    )
  ) +
  geom_smooth(span = 0.2, se = FALSE) 
```
